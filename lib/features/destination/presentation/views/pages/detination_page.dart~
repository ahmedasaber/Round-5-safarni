import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:http/http.dart' as http;

import '../../data/datasource/destination_remote_data_source.dart';
import '../../data/repositories/destination_repository_impl.dart';
import '../../domain/usecases/get_destination_details.dart';
import '../../domain/entities/destination.dart';
import '../cubit/destination_cubit.dart';

import '../widgets/best_time_to_visit.dart';
import '../widgets/botton_bar.dart';
import '../widgets/build_top_section.dart';
import '../widgets/gallery.dart';
import '../widgets/reviews.dart';
import '../widgets/top_activates.dart';
import '../widgets/trip_details.dart';

class DestinationView extends StatelessWidget {
  const DestinationView({super.key});
  static const routeName = '/destination';

  @override
  Widget build(BuildContext context) {
    return BlocProvider(
      create: (_) {
        final dataSource = DestinationRemoteDataSourceImpl(http.Client());
        final repository = DestinationRepositoryImpl(dataSource);
        final usecase = GetDestinationDetails(repository);
        return DestinationCubit(usecase)..fetchDestination("1");
      },
      child: Scaffold(
        body: BlocBuilder<DestinationCubit, DestinationState>(
          builder: (context, state) {
            if (state is DestinationLoading) {
              return const Center(child: CircularProgressIndicator());
            } else if (state is DestinationError) {
              return Center(child: Text(state.message));
            } else if (state is DestinationLoaded) {
              final destination = state.destination;
              return SingleChildScrollView(
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: <Widget>[
                    BuildTopSection(imageUrl: destination.images.first),
                    TripDetails(destination: destination),
                    TopActivates(activities: destination.topActivities),
                    BestTimeToVisit(text: destination.bestTimeToVisit),
                    Gallery(images: destination.images),
                    Reviews(), // هنا تقدر تخليها dynamic لو جاي من الـ API
                    const SizedBox(height: 100),
                  ],
                ),
              );
            }
            return const SizedBox();
          },
        ),
        bottomNavigationBar: const BottomBar(),
      ),
    );
  }
}
